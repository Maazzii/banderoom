<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0/EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.mapper.memberMapper">
	<insert id="regmember" parameterType="generalMembersVO">
		INSERT INTO member (
			midx,
			mid,
			password,
			addr,
			phone,
			regdate
		) values (
			midx_seq.nextval,
			#{mid},
			#{password},
			#{addr},
			#{phone},
			sysdate
		)
	</insert>
	
	<select id="isEmailKeyExist" resultType="int" parameterType="emailRegVO">
		select count(*) from emailreg
		where email = #{email}
	</select>
	
	<insert id="setEmailKey" parameterType="emailRegVO">
		insert into emailreg (
			email,
			key,
			deadline
		) values (
			#{email},
			#{key},
			(sysdate + 30/(24*60))
		)
	</insert>
	
	<update id="updateEmailKey" parameterType="emailRegVO">
		update emailreg set
			email = #{email},
			key = #{key},
			deadline = (sysdate + 30/(24*60))
	</update>
	
	<select id="selectEmailReg" parameterType="emailRegVO" resultType="emailRegVO">
		select email, key, deadline
		from emailreg
		where email = #{email}
	</select>
	
	<select id="isEmailExist" resultType="int" parameterType="Map">
		select count(email) from 
		<if test="memberType == 'general'">
			general_members 
		</if>
		<if test="memberType == 'host'">
			host_members 
		</if>
		where email = #{email}
	</select>
	
	<select id="isNicknameExist" resultType="int" parameterType="Map">
		select count(nickname) from
		<if test="memberType == 'general'">
			general_members 
		</if>
		<if test="memberType == 'host'">
			host_members 
		</if>
		where nickname = #{nickname}
	</select>
</mapper>